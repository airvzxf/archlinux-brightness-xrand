# Maintainer: Israel Roldan <israel.alberto.rv@gmail.com>

# Custom variables
_name=brightness-xrandr
_git_owner="airvzxf"
_git_project="archlinux-${_name}"
echo "_git_project: ${_git_project}"
_release_tag=$(
  curl -Ls -o /dev/null -w %{url_effective} "https://github.com/${_git_owner}/${_git_project}/releases/latest" |
    xargs basename
)
echo "_release_tag: ${_release_tag}"
_tag=$(git rev-parse "$_release_tag")
echo "_tag: ${_tag}"
# Join the name of the Git project and the release tag. It removes the letter 'v' from the tag.
_full_name="${_git_project}-${_release_tag/v/}"
echo "_full_name: ${_full_name}"

# PKGBUILD variables
pkgname="${_name}"
pkgver=0
pkgrel=1
pkgdesc="It changes the brightness using the command 'xrandr'."
arch=(x86_64)
url="https://github.com/${_git_owner}/${_git_project}"
license=(GPL3)
depends=(bash xorg-xrandr grep coreutils sed bc)
#source=("${_git_project}.tar.gz::${url}/archive/refs/tags/${_release_tag}.tar.gz")
source=("git+${url}.git#tag=${_tag}?signed")
md5sums=(SKIP)
# Israel Roldan (airvzxf) <israel.alberto.rv@gmail.com>, https://github.com/airvzxf.gpg
validpgpkeys=(
  63ADA633FE7468630D9BC56175530B8B9F74CF3A
)

# Test v1.1
echo "${url}.git?signed#tag=${_tag}"
echo "${url}.git#tag=${_tag}?signed"

# PKGBUILD functions
pkgver() {
  #cd "${srcdir}/${_full_name}" || return
  cd "${_git_project}" || return
  git describe --long --tags --abbrev=7 | sed 's/\([^-]*-g\)/r\1/;s/-/./g'
}

package() {
  cd "${srcdir}/${_full_name}" || return
  #install -Dm644 LICENSE "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
  install -Dm644 README.md "${pkgdir}/usr/share/doc/${pkgname}/README.md"

  cd "src" || return
  install -Dm755 "${pkgname}" "${pkgdir}/usr/bin/${pkgname}"
}
